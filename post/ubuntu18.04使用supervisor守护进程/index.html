<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Ubuntu18.04使用supervisor守护进程 - Lost Temple</title>
<meta name=description content="

    
        ##
    
    问题背景


最近部署了一个python server在我买的服务器上，想让他一直运行，否则一断开服务器的话，python server提供的API就访问不了了。
于是想着用supervisor来做守护进程, 本文就是记录supervisor 的安装、配置、使用技巧，并设置如何supervisor开机自动启动


    
        ##
    
    机器环境


Ubuntu版本：18.04
Ubuntu用户：root


    
        ##
    
    Ubuntu安装supervisor


apt install supervisor


    
        ##
    
    Ubuntu配置supervisor


安装完成后，会生成一个默认的配置文件/etc/supervisor/supervisord.conf， 这个默认配置里面也会load所有在conf.d目录下的配置
root@test:/etc/supervisor# tree
.
|-- conf.d
|   `-- we.conf
`-- supervisord.conf

1 directory, 2 files
supervisord.conf这个默认配置会load所有在conf.d目录下的配置，所以我们接下来在conf.d目录下新建一个我们自己的配置
touch /etc/supervisor/conf.d/we.conf
参照默认配置文件supervisord.conf里的内容改改，配置内容如下
[program:we]
directory=/home/test/
command=sh we.sh
autostart=true
autorestart=true
startretries=10
redirect_stderr=true
stdout_logfile=/home/test/out.log
具体也可参照官方给的详细文档： http://supervisord.org/configuration.html


    
        ##
    
    检查supervisor的状态


1、检查supervisor的状态
ps aux | grep supervisor

root@test:/etc/supervisor# ps aux | grep supervisor
root      2551  0.0  2.0  65580 21508 ?        Ss   12:39   0:09 /usr/bin/python /usr/bin/supervisord -n -c /etc/supervisor/supervisord.conf
root      7720  0.0  0.1  13116  1044 pts/0    S+   16:46   0:00 grep --color=auto supervisor
当看到如上对应的进程，就说明supervisor启动是成功的。"><link rel=icon type=image/x-icon href=https://jerrygoodluck.github.io/favicon.ico><link rel=apple-touch-icon-precomposed href=https://jerrygoodluck.github.io/favicon.png><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><link rel=stylesheet href=/css/style.min.184a655c5ad8596648622468e6696abf0cf0a2cf8266df17b4f7a36fe9c97551.css integrity="sha256-GEplXFrYWWZIYiRo5mlqvwzwos+CZt8XtPejb+nJdVE="><link rel=stylesheet href=/css/style.min.c4c04b3ef88e3d619ad4c7ee5e03048422bc55c4fefdc1f07657c1133670aa22.css integrity="sha256-xMBLPviOPWGa1MfuXgMEhCK8VcT+/cHwdlfBEzZwqiI="><link rel=stylesheet href=/css/style.min.21c5d8fe0a79d623b0adc1ce4bd4f6dd2c05cd939c9aaaa966ba7186b1464f4d.css integrity="sha256-IcXY/gp51iOwrcHOS9T23SwFzZOcmqqpZrpxhrFGT00="><script src=/js/script.min.08f04d96386c73c9bf4d160333f8f448c05a6e01c06770542ee0e013954ce930.js type=text/javascript integrity="sha256-CPBNljhsc8m/TRYDM/j0SMBabgHAZ3BULuDgE5VM6TA="></script></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><div class=header-top-left><h1 class="site-title noselect"><a href=/>Lost Temple</a></h1><div class=theme-switcher><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-sun-high"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14.828 14.828A4 4 0 109.172 9.172a4 4 0 005.656 5.656z"/><path d="M6.343 17.657l-1.414 1.414"/><path d="M6.343 6.343 4.929 4.929"/><path d="M17.657 6.343l1.414-1.414"/><path d="M17.657 17.657l1.414 1.414"/><path d="M4 12H2"/><path d="M12 4V2"/><path d="M20 12h2"/><path d="M12 20v2"/></svg></span></div><script>const STORAGE_KEY="user-color-scheme",defaultTheme="auto";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");function switchTheme(){currentTheme=currentTheme==="dark"?"light":"dark",localStorage&&localStorage.setItem(STORAGE_KEY,currentTheme),document.documentElement.setAttribute("data-theme",currentTheme),changeGiscusTheme(currentTheme),document.body.dispatchEvent(new CustomEvent(currentTheme+"-theme-set"))}const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeGiscusTheme(currentTheme),document.body.dispatchEvent(new CustomEvent(currentTheme+"-theme-set"))};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme==="auto"?(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)):document.documentElement.setAttribute("data-theme",currentTheme),switchButton&&switchButton.addEventListener("click",switchTheme,!1),showContent()});function detectCurrentScheme(){return localStorage!==null&&localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function showContent(){document.body.style.visibility="visible",document.body.style.opacity=1}function changeGiscusTheme(e){function t(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}t({setConfig:{theme:e}})}</script><ul class="social-icons noselect"><li><a href=https://gohugo.io/documentation/ title=Docs rel=me><span class=inline-svg><svg class="icon icon-tabler icon-tabler-file-type-doc" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 001 1h4"/><path d="M5 12V5a2 2 0 012-2h7l5 5v4"/><path d="M5 15v6h1a2 2 0 002-2v-2a2 2 0 00-2-2H5z"/><path d="M20 16.5a1.5 1.5.0 00-3 0v3a1.5 1.5.0 003 0"/><path d="M12.5 15a1.5 1.5.0 011.5 1.5v3a1.5 1.5.0 01-3 0v-3a1.5 1.5.0 011.5-1.5z"/></svg></span></a></li><li><a href=https://github.com/JerryGoodLuck/hugo-theme-anubis2 title=Github rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-github"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></span></a></li><li><a href=https://www.linkedin.com/ title=Linkedin rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></span></a></li><li><a href=example@example.com title=Email rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></span></a></li><li><a href=# title=Facebook rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-facebook"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 011-1h3V3h-3a5 5 0 00-5 5v2H7"/></svg></span></a></li><li><a href=# title=Instagram rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-instagram"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 4a4 4 0 014-4h8a4 4 0 014 4v8a4 4 0 01-4 4H8a4 4 0 01-4-4z"/><path d="M12 12m-3 0a3 3 0 106 0 3 3 0 10-6 0"/><path d="M16.5 7.5v.01"/></svg></span></a></li><li><a href=# title="Netease music" rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-netease-music"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 4c-2.93 1.346-5 5.046-5 8.492C4 17 8 20 12 20s8-3 8-7c0-3.513-3.5-5.513-6-5.513S9 9 9 12c0 2 1.5 3 3 3s3-1 3-3c0-3.513-2-4.508-2-6.515.0-3.504 3.5-2.603 4-1.502"/></svg></span></a></li><li><a href=# title=Telegram rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-telegram"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4 6 6 4-16-18 7 4 2 2 6 3-4"/></svg></span></a></li><li><a href=# title=X rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></span></a></li><li><a href=# title=Youtube rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-youtube"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M2 8a4 4 0 014-4h12a4 4 0 014 4v8a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/><path d="M10 9l5 3-5 3z"/></svg></span></a></li><li><a href=/index.xml title=RSS rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></span></a></li></ul></div><div class=header-top-right></div></div><nav class=noselect><a href=https://jerrygoodluck.github.io/ title>Home</a>
<a href=https://jerrygoodluck.github.io/about/ title>About</a>
<a href=https://jerrygoodluck.github.io/tags/ title>Tags</a>
<a href=https://jerrygoodluck.github.io/posts/ title>Archive</a>
<a href=https://jerrygoodluck.github.io/about/ title=About>About</a></nav></header><main id=main tabindex=-1><article class="post h-entry"><div class=post-header><header><h1 class="p-name post-title">Ubuntu18.04使用supervisor守护进程</h1></header><div class="post-info noselect"><div class="post-date dt-published"><time datetime=2022-08-07>2022-08-07</time></div><a class="post-hidden-url u-url" href=/post/ubuntu18.04%E4%BD%BF%E7%94%A8supervisor%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/>/post/ubuntu18.04%E4%BD%BF%E7%94%A8supervisor%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/</a>
<a href=https://jerrygoodluck.github.io/ class="p-name p-author post-hidden-author h-card" rel=me>map[email: location:China name:zy]</a><div class=post-taxonomies><ul class=post-categories><li><a href>杂记</a></li></ul><ul class=post-tags><li><a href=/tags/linux/>#Linux</a></li></ul></div></div></div><details class="toc noselect"><summary>Table of Contents</summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#问题背景>问题背景</a></li><li><a href=#机器环境>机器环境</a></li><li><a href=#ubuntu安装supervisor>Ubuntu安装supervisor</a></li><li><a href=#ubuntu配置supervisor>Ubuntu配置supervisor</a></li><li><a href=#检查supervisor的状态>检查supervisor的状态</a></li><li><a href=#supervisorctl-常用命令>supervisorctl 常用命令</a></li><li><a href=#设置supervisor开机启动>设置supervisor开机启动</a></li><li><a href=#mac设置supervisor>mac设置supervisor</a></li></ul></li></ul></nav></div></details><script>var toc=document.querySelector(".toc");toc&&toc.addEventListener("click",function(){event.target.tagName!=="A"&&(event.preventDefault(),this.open?(this.open=!1,this.classList.remove("expanded")):(this.open=!0,this.classList.add("expanded")))})</script><div class="content e-content"><h3 id=问题背景><div><a href=#%e9%97%ae%e9%a2%98%e8%83%8c%e6%99%af>##
</a>问题背景</div></h3><p>最近部署了一个python server在我买的服务器上，想让他一直运行，否则一断开服务器的话，python server提供的API就访问不了了。</p><p>于是想着用supervisor来做守护进程, 本文就是记录supervisor 的安装、配置、使用技巧，并设置如何supervisor开机自动启动</p><h3 id=机器环境><div><a href=#%e6%9c%ba%e5%99%a8%e7%8e%af%e5%a2%83>##
</a>机器环境</div></h3><p>Ubuntu版本：18.04</p><p>Ubuntu用户：root</p><h3 id=ubuntu安装supervisor><div><a href=#ubuntu%e5%ae%89%e8%a3%85supervisor>##
</a>Ubuntu安装supervisor</div></h3><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apt install supervisor
</span></span></code></pre></div><h3 id=ubuntu配置supervisor><div><a href=#ubuntu%e9%85%8d%e7%bd%aesupervisor>##
</a>Ubuntu配置supervisor</div></h3><p>安装完成后，会生成一个默认的配置文件/etc/supervisor/supervisord.conf， 这个默认配置里面也会load所有在conf.d目录下的配置</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@test:/etc/supervisor# tree
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>|-- conf.d
</span></span><span style=display:flex><span>|   <span style=color:#5af78e>`</span>-- we.conf
</span></span><span style=display:flex><span><span style=color:#5af78e>`</span>-- supervisord.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff9f43>1</span> directory, <span style=color:#ff9f43>2</span> files
</span></span></code></pre></div><p>supervisord.conf这个默认配置会load所有在conf.d目录下的配置，所以我们接下来在conf.d目录下新建一个我们自己的配置</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>touch /etc/supervisor/conf.d/we.conf
</span></span></code></pre></div><p>参照默认配置文件supervisord.conf里的内容改改，配置内容如下</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ff6ac1>[</span>program:we<span style=color:#ff6ac1>]</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>directory</span><span style=color:#ff6ac1>=</span>/home/test/
</span></span><span style=display:flex><span><span style=color:#ff5c57>command</span><span style=color:#ff6ac1>=</span>sh we.sh
</span></span><span style=display:flex><span><span style=color:#ff5c57>autostart</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>true</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>autorestart</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>true</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>startretries</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>redirect_stderr</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>true</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>stdout_logfile</span><span style=color:#ff6ac1>=</span>/home/test/out.log
</span></span></code></pre></div><p>具体也可参照官方给的详细文档： <a href=http://supervisord.org/configuration.html>http://supervisord.org/configuration.html</a></p><h3 id=检查supervisor的状态><div><a href=#%e6%a3%80%e6%9f%a5supervisor%e7%9a%84%e7%8a%b6%e6%80%81>##
</a>检查supervisor的状态</div></h3><p>1、检查supervisor的状态</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ps aux | grep supervisor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@test:/etc/supervisor# ps aux | grep supervisor
</span></span><span style=display:flex><span>root      <span style=color:#ff9f43>2551</span>  0.0  2.0  <span style=color:#ff9f43>65580</span> <span style=color:#ff9f43>21508</span> ?        Ss   12:39   0:09 /usr/bin/python /usr/bin/supervisord -n -c /etc/supervisor/supervisord.conf
</span></span><span style=display:flex><span>root      <span style=color:#ff9f43>7720</span>  0.0  0.1  <span style=color:#ff9f43>13116</span>  <span style=color:#ff9f43>1044</span> pts/0    S+   16:46   0:00 grep --color<span style=color:#ff6ac1>=</span>auto supervisor
</span></span></code></pre></div><p>当看到如上对应的进程，就说明supervisor启动是成功的。</p><p>2、检查守护的进程的状态</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>root@test:/etc/supervisor# supervisorctl
</span></span><span style=display:flex><span>we                        RUNNING   pid 2603, uptime 4:05:59
</span></span></code></pre></div><p>我们就可以看到我们配置的守护进程的状态，如果不在运行，会有相应的错误信息，可以去刚才配置的log目录查看日志：</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>less /home/test/out.log
</span></span></code></pre></div><h3 id=supervisorctl-常用命令><div><a href=#supervisorctl-%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4>##
</a>supervisorctl 常用命令</div></h3><table><thead><tr><th style=text-align:left>command</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>supervisorctl stop program_name</td><td style=text-align:left>停止某个进程</td></tr><tr><td style=text-align:left>supervisorctl start program_name</td><td style=text-align:left>启动某个进程</td></tr><tr><td style=text-align:left>supervisorctl restart program_name</td><td style=text-align:left>重启某个进程</td></tr><tr><td style=text-align:left>supervisorctl stop all</td><td style=text-align:left>停止全部进程</td></tr><tr><td style=text-align:left>supervisorctl reload</td><td style=text-align:left>载入最新的配置文件，停止原有进程并按新的配置启动、管理所有进程</td></tr><tr><td style=text-align:left>supervisorctl update</td><td style=text-align:left>根据最新的配置文件，启动新配置或有改动的进程，配置没有改动的进程不会受影响而重启</td></tr></tbody></table><h3 id=设置supervisor开机启动><div><a href=#%e8%ae%be%e7%bd%aesupervisor%e5%bc%80%e6%9c%ba%e5%90%af%e5%8a%a8>##
</a>设置supervisor开机启动</div></h3><p>如果使用apt安装的，一般来说会自动设置好开机启动，但是如果你重启之后发现没有开机自动启动，可以按照下面的方法配置。</p><p>把下面的命令写进 rc.local 即可：</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>/usr/bin/supervisord
</span></span></code></pre></div><h3 id=mac设置supervisor><div><a href=#mac%e8%ae%be%e7%bd%aesupervisor>##
</a>mac设置supervisor</div></h3><p>1、brew 安装supervisor</p><p>如果你还没有安装brew，这里使他们的官网https://brew.sh/，安装brew的命令：</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>/bin/bash -c <span style=color:#5af78e>&#34;</span><span style=color:#ff6ac1>$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span style=color:#ff6ac1>)</span><span style=color:#5af78e>&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>brew install supervisor
</span></span><span style=display:flex><span>brew services restart supervisor
</span></span></code></pre></div><p>2、配置文件，先打开默认配置文件</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vim /usr/local/etc/supervisord.conf
</span></span></code></pre></div><p>3、这是它的默认配置：</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>;<span style=color:#ff6ac1>[</span>program:theprogramname<span style=color:#ff6ac1>]</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>command</span><span style=color:#ff6ac1>=</span>/bin/cat              ; the program <span style=color:#ff6ac1>(</span>relative uses PATH, can take args<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>process_name</span><span style=color:#ff6ac1>=</span>%<span style=color:#ff6ac1>(</span>program_name<span style=color:#ff6ac1>)</span>s ; process_name expr <span style=color:#ff6ac1>(</span>default %<span style=color:#ff6ac1>(</span>program_name<span style=color:#ff6ac1>)</span>s<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>numprocs</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>                    ; number of processes copies to start <span style=color:#ff6ac1>(</span>def 1<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>directory</span><span style=color:#ff6ac1>=</span>/tmp                ; directory to cwd to before <span style=color:#ff5c57>exec</span> <span style=color:#ff6ac1>(</span>def no cwd<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>umask</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>022</span>                     ; <span style=color:#ff5c57>umask</span> <span style=color:#ff6ac1>for</span> process <span style=color:#ff6ac1>(</span>default None<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>priority</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>999</span>                  ; the relative start priority <span style=color:#ff6ac1>(</span>default 999<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>autostart</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>true</span>                ; start at supervisord start <span style=color:#ff6ac1>(</span>default: <span style=color:#ff5c57>true</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>startsecs</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>                   ; <span style=color:#78787e># of secs prog must stay up to be running (def. 1)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>startretries</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>3</span>                ; max <span style=color:#78787e># of serial start failures when starting (default 3)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>autorestart</span><span style=color:#ff6ac1>=</span>unexpected        ; when to restart <span style=color:#ff6ac1>if</span> exited after running <span style=color:#ff6ac1>(</span>def: unexpected<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>exitcodes</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>0</span>                   ; <span style=color:#5af78e>&#39;expected&#39;</span> <span style=color:#ff5c57>exit</span> codes used with autorestart <span style=color:#ff6ac1>(</span>default 0<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stopsignal</span><span style=color:#ff6ac1>=</span>QUIT               ; signal used to <span style=color:#ff5c57>kill</span> process <span style=color:#ff6ac1>(</span>default TERM<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stopwaitsecs</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>               ; max num secs to <span style=color:#ff5c57>wait</span> b4 SIGKILL <span style=color:#ff6ac1>(</span>default 10<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stopasgroup</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>false</span>             ; send stop signal to the UNIX process group <span style=color:#ff6ac1>(</span>default <span style=color:#ff5c57>false</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>killasgroup</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>false</span>             ; SIGKILL the UNIX process group <span style=color:#ff6ac1>(</span>def <span style=color:#ff5c57>false</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>user</span><span style=color:#ff6ac1>=</span>chrism                   ; setuid to this UNIX account to run the program
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>redirect_stderr</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>true</span>          ; redirect proc stderr to stdout <span style=color:#ff6ac1>(</span>default <span style=color:#ff5c57>false</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stdout_logfile</span><span style=color:#ff6ac1>=</span>/a/path        ; stdout log path, NONE <span style=color:#ff6ac1>for</span> none; default AUTO
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stdout_logfile_maxbytes</span><span style=color:#ff6ac1>=</span>1MB   ; max <span style=color:#78787e># logfile bytes b4 rotation (default 50MB)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stdout_logfile_backups</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>     ; <span style=color:#78787e># of stdout logfile backups (0 means none, default 10)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stdout_capture_maxbytes</span><span style=color:#ff6ac1>=</span>1MB   ; number of bytes in <span style=color:#5af78e>&#39;capturemode&#39;</span> <span style=color:#ff6ac1>(</span>default 0<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stdout_events_enabled</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>false</span>   ; emit events on stdout writes <span style=color:#ff6ac1>(</span>default <span style=color:#ff5c57>false</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stdout_syslog</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>false</span>           ; send stdout to syslog with process name <span style=color:#ff6ac1>(</span>default <span style=color:#ff5c57>false</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stderr_logfile</span><span style=color:#ff6ac1>=</span>/a/path        ; stderr log path, NONE <span style=color:#ff6ac1>for</span> none; default AUTO
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stderr_logfile_maxbytes</span><span style=color:#ff6ac1>=</span>1MB   ; max <span style=color:#78787e># logfile bytes b4 rotation (default 50MB)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stderr_logfile_backups</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>     ; <span style=color:#78787e># of stderr logfile backups (0 means none, default 10)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stderr_capture_maxbytes</span><span style=color:#ff6ac1>=</span>1MB   ; number of bytes in <span style=color:#5af78e>&#39;capturemode&#39;</span> <span style=color:#ff6ac1>(</span>default 0<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stderr_events_enabled</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>false</span>   ; emit events on stderr writes <span style=color:#ff6ac1>(</span>default <span style=color:#ff5c57>false</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>stderr_syslog</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>false</span>           ; send stderr to syslog with process name <span style=color:#ff6ac1>(</span>default <span style=color:#ff5c57>false</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>environment</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>A</span><span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;1&#34;</span>,B<span style=color:#ff6ac1>=</span><span style=color:#5af78e>&#34;2&#34;</span>       ; process environment additions <span style=color:#ff6ac1>(</span>def no adds<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>;<span style=color:#ff5c57>serverurl</span><span style=color:#ff6ac1>=</span>AUTO                ; override serverurl computation <span style=color:#ff6ac1>(</span>childutils<span style=color:#ff6ac1>)</span>
</span></span></code></pre></div><p>4、我们可以复制一份，改一改，改成我们自己想要启动程序的配置，比如我想要启动gos</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ff6ac1>[</span>program:gitgos<span style=color:#ff6ac1>]</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>command</span><span style=color:#ff6ac1>=</span>/Users/yzw/Downloads/gitzub/gogs/gogs web -p <span style=color:#ff9f43>3008</span>              ; the program <span style=color:#ff6ac1>(</span>relative uses PATH, can take args<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>process_name</span><span style=color:#ff6ac1>=</span>%<span style=color:#ff6ac1>(</span>program_name<span style=color:#ff6ac1>)</span>s ; process_name expr <span style=color:#ff6ac1>(</span>default %<span style=color:#ff6ac1>(</span>program_name<span style=color:#ff6ac1>)</span>s<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>numprocs</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>                    ; number of processes copies to start <span style=color:#ff6ac1>(</span>def 1<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>directory</span><span style=color:#ff6ac1>=</span>/Users/yzw/Downloads/gitzub/gogs/                ; directory to cwd to before <span style=color:#ff5c57>exec</span> <span style=color:#ff6ac1>(</span>def no cwd<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>autostart</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>true</span>                ; start at supervisord start <span style=color:#ff6ac1>(</span>default: <span style=color:#ff5c57>true</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>startsecs</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>1</span>                   ; <span style=color:#78787e># of secs prog must stay up to be running (def. 1)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>startretries</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>3</span>                ; max <span style=color:#78787e># of serial start failures when starting (default 3)</span>
</span></span><span style=display:flex><span>; <span style=color:#ff5c57>stopasgroup</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>true</span>             ; send stop signal to the UNIX process group <span style=color:#ff6ac1>(</span>default <span style=color:#ff5c57>false</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span>; <span style=color:#ff5c57>killasgroup</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>true</span>             ; SIGKILL the UNIX process group <span style=color:#ff6ac1>(</span>def <span style=color:#ff5c57>false</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>user</span><span style=color:#ff6ac1>=</span>zhiwei                   ; setuid to this UNIX account to run the program
</span></span><span style=display:flex><span><span style=color:#ff5c57>redirect_stderr</span><span style=color:#ff6ac1>=</span><span style=color:#ff5c57>true</span>          ; redirect proc stderr to stdout <span style=color:#ff6ac1>(</span>default <span style=color:#ff5c57>false</span><span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>stdout_logfile</span><span style=color:#ff6ac1>=</span>/Users/zhiwei/Downloads/gitzub/gogs/log/data.log        ; stdout log path, NONE <span style=color:#ff6ac1>for</span> none; default AUTO
</span></span><span style=display:flex><span><span style=color:#ff5c57>stdout_logfile_maxbytes</span><span style=color:#ff6ac1>=</span>10MB   ; max <span style=color:#78787e># logfile bytes b4 rotation (default 50MB)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>stdout_logfile_backups</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>     ; <span style=color:#78787e># of stdout logfile backups (0 means none, default 10)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>stdout_capture_maxbytes</span><span style=color:#ff6ac1>=</span>10MB   ; number of bytes in <span style=color:#5af78e>&#39;capturemode&#39;</span> <span style=color:#ff6ac1>(</span>default 0<span style=color:#ff6ac1>)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>stderr_logfile</span><span style=color:#ff6ac1>=</span>/Users/zhiwei/Downloads/gitzub/gogs/log/error.log       ; stderr log path, NONE <span style=color:#ff6ac1>for</span> none; default AUTO
</span></span><span style=display:flex><span><span style=color:#ff5c57>stderr_logfile_maxbytes</span><span style=color:#ff6ac1>=</span>10MB   ; max <span style=color:#78787e># logfile bytes b4 rotation (default 50MB)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>stderr_logfile_backups</span><span style=color:#ff6ac1>=</span><span style=color:#ff9f43>10</span>     ; <span style=color:#78787e># of stderr logfile backups (0 means none, default 10)</span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>stderr_capture_maxbytes</span><span style=color:#ff6ac1>=</span>10MB   ; number of bytes in <span style=color:#5af78e>&#39;capturemode&#39;</span> <span style=color:#ff6ac1>(</span>default 0<span style=color:#ff6ac1>)</span>
</span></span></code></pre></div><p>5、然后再执行命令重新加载下配置，使得新的配置生效， 然后再执行supervisorctl命令，查看gos是否启动成功，状态为RUNNING则成功启动。</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>supervisorctl reload
</span></span><span style=display:flex><span>➜ supervisorctl
</span></span><span style=display:flex><span>gitgos                           RUNNING   pid 44926, uptime 0:41:54
</span></span><span style=display:flex><span>supervisor&gt;
</span></span></code></pre></div></div></article><h3 class="read-next-title noselect">Read next</h3><ul class="read-next-posts noselect"><li><a href=/post/wget%E7%94%A8%E6%B3%95/>Wget用法</a></li></ul><div class="pagination post-pagination"><div class="left pagination-item"><a href=/post/mysql57_character/>Ubuntu18.04/Mysql5.7改成utf8编码</a></div><div class="right pagination-item"><a href=/post/vue%E6%8A%A5%E9%94%99%E5%A4%A7%E5%85%A8/>Vue Vite初学报错大全</a></div></div></main><footer class="common-footer noselect"><ul class=language-select><li>English</li><li><a href=/pl/>Polski</a></li><li><a href=/zh/>Chinese</a></li></ul><div class=common-footer-bottom><div style=display:flex;align-items:center;gap:8px>© zy, 2024
<a aria-label="Check statistics data" style=display:flex;align-items:center;border-bottom:none;cursor:pointer;color:var(--pagination-link-color) href=https://umami.xtra.science/share/Fy0goUn0b9rrxxGe/hugo-theme-anubis2.netlify.app><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-report-analytics"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 5H7A2 2 0 005 7v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><path d="M9 3m0 2a2 2 0 012-2h2a2 2 0 012 2v0a2 2 0 01-2 2h-2A2 2 0 019 5z"/><path d="M9 17v-5"/><path d="M12 17v-1"/><path d="M15 17v-3"/></svg></a></div><div style=display:flex;align-items:center></div><div>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/Junyi-99/hugo-theme-anubis2>Anubis2</a>.<br></div></div><p class="h-card vcard"><a href=https://jerrygoodluck.github.io/ class="p-name u-url url fn" rel=me>map[email: location:China name:zy]</a></p></footer></div></body></html>